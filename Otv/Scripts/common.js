function videoObjectRemove(e) { if (!$(".video-Box").length) return; e ? (e.find(".video-View").empty().attr("style", "").removeClass("View-fixed"), e.find(".video-Img").show(), e.find(".video-View").hide()) : ($(".video-Box").find(".video-View").empty().attr("style", "").removeClass("View-fixed"), $(".video-Box").find(".video-Img").show(), $(".video-Box").find(".video-View").hide()) } function loadScript(e, t) { if (!e) return; var n = document.createElement("script"); n.src = e, n.onload = function () { t && t() }, n.onerror = function () { t && t("error") }, document.body.appendChild(n) } var App = App || {}; App.ui = App.ui || {}, App.dataApi = { hotMovie: "http://api.btime.com/Pcthirdapi/hotvideo", cinema: "http://api.btime.com/Pcthirdapi/onlinevideo", hotTv: "http://api.btime.com/Pcthirdapi/hottv", movieLibrary: "http://api.btime.com/Pcthirdapi/videolist", hotNews: "http://api.btime.com/pcthirdapi/hotnews", beijing: "http://api.btime.com/Pcthirdapi/localnews?local=Beijing", appList: "http://api.btime.com/Pcthirdapi/getsoftlist", btvList: "http://api.btime.com/Pcthirdapi/getBtvChannel", scroll: "http://api.btime.com/news/getNewsList", tuijian: "http://api.btime.com/Pcthirdapi/tuijian", videoList: "http://api.btime.com/Pcthirdapi/videoType", newList: "http://api.btime.com/news/getNewsListByTypeName", picNewList: "http://api.btime.com/Pcthirdapi/picNewsList", userLogin: "http://user.btime.com/getUserInfo", userLoginOut: "http://user.btime.com/logout", videoPlay: "http://api.btime.com/video/play", bjMedia: "http://api.btime.com/Pcthirdapi/bjMedia", mediaKd: "http://api.btime.com/Pcthirdapi/getBjMediaScore", liveList: "http://record.btime.com/getFeedNewsList", live: "http://api.btime.com/Pcthirdapi/videoType", getLocalNews: "http://api.btime.com/news/getLocalNews", getLocation: "http://api.btime.com/api/getLocation", getBtVideo: "http://api.btime.com/Pcthirdapi/getBtVideo" }, App.scrollfix = function () { $(".N-nav").height() < $(window).height() && $(window).width() > $(".N-row").width() && $(".N-nav").scrollFix({ distanceTop: 22, zIndex: 100 }), $(window).width() > $(".N-row").width() && $(".N-col-fix").scrollFix({ bottom: 15, zIndex: 100 }), $(window).width() > $(".N-row").width() && $(".article-nav").scrollFix({ distanceTop: 0, zIndex: 100 }), $(".N-ft").parent(".N-mod").css({ border: "none" }) }, App.focusImg = function () { $('[data-focus="focus"]').each(function () { function x() { var n = v.eq(0).find("img"), i = v.eq(y - 1).find("img"); l.css({ width: y * (g + 6) }), App.ui.cur(m.eq(e)), w.html("<span>" + (a.find(".cur").index() + 1) + "</span>" + "/" + "<em>" + y + "</em>"), n.attr("src", n.data("src")), i.attr("src", i.data("src")), v.eq(t).fadeIn(r); for (var s = 0; s < 4; s++) { var o = m.eq(s).find("img"); o.attr("src", o.data("src")) } } function T() { App.ui.cur(m.eq(t)), b.fadeOut(n, function () { var e = v.eq(t).find("img"); e.attr("src", e.data("src")), v.eq(t).fadeIn(r); for (var n = 1; n < 4; n++) { var i = m.eq(t + n).find("img"); i.attr("src", i.data("src")) } }); if (a.find(".cur").index() > 2 && a.find(".cur").index() != y - 1) { var e = (a.find(".cur").index() + 1 - 3) * (g + 4); l.animate({ left: -e }) } else a.find(".cur").index() < 3 && l.animate({ left: 0 }); b = v.eq(t), w.find("span").text(a.find(".cur").index() + 1), w.find("em").text(y) } function N() { t++, t == y && (t = 0), T() } function C() { u = setInterval(N, i) } function k() { u && (clearInterval(u), u = !1) } var e = 0, t = 0, n = 200, r = 300, i = 5e3, s = "click", o = !0, u = !1, a = $(this), f = a.find(".focus-list ul"), l = a.find(".focus-tab ul"), c = a.find(".prev"), h = a.find(".next"), p = window.location.search, d, v, m, g, y, b, w; if (/[?&]src=(.*?)(&|#|$)/.test(p)) { d = RegExp.$1; var E = a.find('.focus-list [data-src="' + d + '"]'), S = a.find('.focus-tab [data-src="' + d + '"]'); E.removeClass("hz"), S.removeClass("hz"), f.prepend(E), l.prepend(S) } a.find(".hz").remove(), v = a.find(".focus-list li"), m = a.find(".focus-tab li"), g = m.width(), y = v.length, b = v.eq(e), w = a.find(".focus-num"), c.off("click").on("click", function () { if (t == 0) for (var e = y; e > 0; e--) { var n = m.eq(e).find("img"); n.attr("src", n.data("src")) } t--, t < 0 && (t += y), T(); var r = (a.find(".cur").index() - 3) * (g + 4); a.find(".cur").index() == y - 1 && l.animate({ left: -r }) }), h.off("click").on("click", function () { N(), a.find(".cur").index() == 0 && l.animate({ left: 0 }) }), m.off(s).on(s, function (e) { e.preventDefault(); if ($(this).hasClass("cur")) return; t = $(this).index(), T(), $(this).find("a").blur() }), x(), a.hover(function () { k() }, function () { C() }), o && C() }) }, App.focusVideoImg = function () { $('[data-focus="video_focus"]').each(function () { function v() { l.eq(0).addClass("cur"); for (var e = 0; e < 4; e++) { var t = l.eq(e).find("img"); t.attr("src", t.data("src")) } } function m() { d && d.fadeOut(), p = f.eq(t); if (!p.find("[data_video]").attr("data_video")) p.find(".video_stream").val() ? ($("#focus_video_player").show(), g(p.find(".video_stream").val(), 1, "focus_video_player")) : ($("#focus_video_player").hide(), p.find("img").attr("src", p.find("img").data("src")), p.fadeIn()); else { $("#focus_video_player").show(), p.find(".title").hide(); var e = p.find("[data_video]").attr("data_video"), n = "focus_video_player"; $.ajax({ type: "get", dataType: "jsonp", data: { id: e }, url: App.dataApi.videoPlay }).done(function (e) { if (e.errno == 0) { var e = e.data, t = e.play_status; if (e.video_stream[2]) var r = e.video_stream[2].stream_url; else if (e.video_stream[1]) var r = e.video_stream[1].stream_url; else if (e.video_stream[0]) var r = e.video_stream[0].stream_url; g(r, t, n) } }) } } function g(e, t, n) { if (t == 1) var r = "liveplay"; else if (t == 2) var r = "replay"; var i = { sn: e, type: r }; playSwf = "http://s4.qhimg.com/static/7e25b847945484bb/BeijingTime.swf", playerProductInstall = "http://s1.qhimg.com/static/db3e04bd6db0bbba.swf"; var s = { menu: "false", wmode: "window", bgcolor: "#000000", allowFullScreen: "true", allowScriptAccess: "always" }; swfobject.embedSWF(playSwf, n, "640", "275", "6.0.0", playerProductInstall, i, s) } var e = 0, t = 0, n = 200, r = 300, i = 5e3, s = "click", o = !0, u = $(this), a = u.find(".focus-tab ul"), f = u.find(".focus-list li"), l = u.find(".focus-tab li"), c = l.width(), h = f.length, p = f.eq(e), d = null; l.on("click", function (e) { e.preventDefault(); if ($(this).hasClass("cur")) return; d = f.eq(t), t = $(this).index(), $(".focus[data-focus] .cur").removeClass("cur"), $(this).addClass("cur"), m() }), m(), v() }) }, App.calendar = function () { var e = $(".calendar-day"), t = $(".calendar-week"), n = new Date, r = n.getMonth() + 1, i = n.getDate(), s = ["\u661f\u671f\u65e5", "\u661f\u671f\u4e00", "\u661f\u671f\u4e8c", "\u661f\u671f\u4e09", "\u661f\u671f\u56db", "\u661f\u671f\u4e94", "\u661f\u671f\u516d"]; e.html(r + "\u6708" + i + "\u65e5"), t.html(s[n.getDay()]) }, App.tab = function () { $("[data-tab]").each(function () { var e = "mouseover", t = $(this), n = t.data("tab"), r = t.siblings("[data-con]"), i = r.data("con"), s = t.find(n), o = r.find(i), u = s.toArray(); s.on(e, function (e) { e.preventDefault(); var t = $(this), n = t.index(), r = o.eq(n); App.ui.cur(t), r.show().siblings(o).hide(), t.blur() }) }), $("#milWeapon").mouseleave(function () { $(this).find(".weapon-tab li").removeClass("cur"), $(this).find(".weapon-con li").hide() }) }, App.hotMovie = function () { var e = $("#hotMovie"), t = App.dataApi.hotMovie; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: t }).done(function (t) { if (t.errno == 0) { var n = [], t = App.ui.sortList(t.data); for (i in t) if (t.hasOwnProperty(i)) { var r = App.ui.score(t[i].score); i == 0 ? n.push('<div class="pic"><a href="', t[i].url, '"><img src="', t[i].cover, '" alt="', t[i].title, '"></a><span class="num">', i * 1 + 1, '</span></div><div class="txt"><h3><a href="', t[i].url, '">', t[i].title, '</a></h3><div class="fraction"><span class="star"><i style="width:', r, '%;"></i></span><em>', t[i].score, "\u5206</em></div><p>", t[i].upinfo, "</p></div>") : n.push('<li><em class="fr">', t[i].score, '\u5206</em><span class="num">', i * 1 + 1, '</span><a href="', t[i].url, '">', t[i].title, "</a></li>") } e.html(n.join("")) } }) }, App.cinema = function () { var e = $("#cinema"), t = App.dataApi.cinema; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: t }).done(function (t) { if (t.errno == 0) { var n = [], r = [], t = App.ui.sortList(t.data); for (i in t) if (t.hasOwnProperty(i)) { var s = App.ui.score(t[i].score); i == 0 ? n.push('<a href="', t[i].url, '"><div class="pic"><img src="', App.ui.recut(t[i].cover, "180_247_", "dmfd"), '" alt="', t[i].title, '"><span class="num">', i * 1 + 1, "</span></div><h4>", t[i].title, '</h4><p><span class="star"><i style="width:', s, '%;"></i></span> ', t[i].score, "\u5206</p></a>") : i > 0 && i < 5 && r.push('<li><a href="', t[i].url, '"><div class="pic"><img src="', App.ui.recut(t[i].cover, "58_75_", "dmfd"), '" alt="', t[i].title, '"><span class="num">', i * 1 + 1, '</span></div><div class="txt"><h4>', t[i].title, "</h4></div></a></li>") } e.find(".cinema-l").html(n.join("")), e.find(".cinema-r ul").html(r.join("")) } }) }, App.hotTvSeries = function () { var e = $("#hotTvSeries"), t = App.dataApi.hotTv; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: t }).done(function (t) { if (t.errno == 0) { var n = [], r = [], t = App.ui.sortList(t.data); for (i in t) if (t.hasOwnProperty(i)) { var s = App.ui.score(t[i].score); i == 0 ? n.push('<dt><a href="', t[i].url, '"><img src="', t[i].cover, '" alt="', t[i].title, '"></a></dt><dd><h4><a href="', t[i].url, '">', t[i].title, '</a></h4><p><span class="star"><i style="width:', s, '%;"></i></span> ', t[i].score, "\u5206</p><p>\u540c\u6b65\u70ed\u64ad</p></dd>") : i > 0 && i < 4 && r.push('<li><a href="', t[i].url, '"><div class="pic"><img src="', t[i].cover, '" alt="', t[i].title, '"><span>\u540c\u6b65\u70ed\u64ad</span></div><div class="txt">', t[i].title, "</div></a></li>") } e.find("dl").html(n.join("")), e.find("ul").html(r.join("")) } }) }, App.movieLibrary = function () { var e = $("#movieLibrary"), t = e.find(".lib-dianshi"), n = e.find(".lib-dianying"), r = $(".movie-search"), s = r.find(".btn"), o = r.find(".ipt"), u = App.dataApi.movieLibrary; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: u }).done(function (e) { if (e.errno == 0) { function r(e) { var t = []; for (i in e) { var n = [], r = i == "cat" && "\u7c7b\u578b" || i == "area" && "\u5730\u533a" || i == "year" && "\u5e74\u4efd" || i == "act" && "\u6f14\u5458"; for (l in e[i]) n.push('<a href="', e[i][l], '">', l, "</a>"); t.push("<li><dl><dt>", r, "\uff1a</dt><dd>", n.join(""), "</dd></dl></li>") } return t.join("") } var u = r(e.data.dianshi), a = r(e.data.dianying), f = e.data.search; t.html(u), n.html(a), s.on("click", function () { var e = o.val(); window.open(f + e) }), o.keyup(function (e) { e.preventDefault(); var t = $(this).val(); e.keyCode == 13 && window.open(f + t) }) } }) }, App.hotNews = function () { var e = $("#hotNews"), t = App.dataApi.hotNews; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: t }).done(function (t) { if (t.errno == 0) { var t = t.data, n = []; for (var r in t) { var i = r * 1 + 1; t.hasOwnProperty(r) && (r < 3 ? n.push('<li class="red">') : n.push("<li>"), n.push("<span>", i, '</span><a href="', t[r].url, '" title="', t[r].title, '">', t[r].title, "</a></li>")) } e.html(n.join("")) } }) }, App.beijingNews = function () { var e = $("#beijingNews"), t = e.find(".img-list ul"), n = e.find(".txt-list"), r = App.dataApi.beijing; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: r }).done(function (e) { if (e.errno == 0) { var e = e.data, r = [], i = []; for (var s in e) e.hasOwnProperty(s) && (s < 2 ? r.push('<li><a href="', e[s].url, '"><div class="pic"><img src="', App.ui.recut(e[s].imgurl, "180_120_", "dmfd"), '" alt="', e[s].title, '"></div><div class="txt twolines">', e[s].title, "</div></a></li>") : s > 2 && s < 6 && i.push('<li><a href="', e[s].url, '">', e[s].title, "</a></li>")) } t.html(r.join("")), n.html(i.join("")) }) }, App.appList = function () { var e = $("#appList ul"), t = App.dataApi.appList; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: t }).done(function (t) { if (t.errno == 0) { var t = t.data, n = []; for (var r in t) t.hasOwnProperty(r) && n.push('<li><div class="pic"><a href="', t[r].down_url, '"><img src="', t[r].logo_url, '" alt=""></a></div><div class="txt"><a href="">', t[r].name, "</a><span>", t[r].single_word, '</span></div><p class="like"><span class="red">', t[r].download_times, "</span>\u4eba \u559c\u6b22</p></li>") } e.html(n.join("")) }) }, App.btvVideo = function () { var e = $("#btvVideo"), t = $("#btvVideoList"), n = App.dataApi.btvList, r = $("#btvVideoImg"), s = e.find("iframe"), o = "http://itv.brtn.cn/tool/player_custom/lives.php?w=380&h=200&url=", u = e.data("videoid"), a = $(".index-wp").length && "0" || $(".news-wp").length && "7" || $(".finance-wp").length && "4" || $(".sports-wp").length && "6" || $(".ent-wp").length && "1" || $(".tech-wp").length && "2" || $(".mil-wp").length && "6" || $(".life-wp").length && "5" || "0"; if (!e.length) return; u != undefined && (a = u), $.ajax({ type: "get", dataType: "jsonp", data: { channel: a }, url: n }).done(function (e) { function f(e) { var e = e, t = { sn: e, type: "liveplay" }, n = { menu: "false", wmode: "window", bgcolor: "#000000", allowScriptAccess: "always", allowFullScreen: !0 }; swfobject.embedSWF("http://s4.qhimg.com/static/7e25b847945484bb/BeijingTime.swf", "btv-video-play", "100%", "100%", "6.0.0", "http://s1.qhimg.com/static/db3e04bd6db0bbba.swf", t, n) } var n = e.data, s = [], o = n[a].video_img; for (i in n) { var u = i == a ? "cur" : ""; n.hasOwnProperty(i) && s.push('<li><a href="#" class="', u, '" data-name="', i, '">', n[i].name, "</a></li>") } t.find("ul").html(s.join("")), r.find("img").attr("src", App.ui.recut(o, "380_220_", "dmfd")), r.on("click", function (e) { e.preventDefault(), setTimeout(function () { r.hide() }, 0), f(n[a].video_Blue_url) }), t.find("li a").on("click", function (e) { e.preventDefault(); var i = $(this).data("name"); r.show(), t.find("li a").removeClass("cur"), $(this).addClass("cur"), f(n[i].video_Blue_url), setTimeout(function () { r.hide() }, 0) }) }) }, App.videoPlay = function () { $(".video-Box").each(function () { function s() { if ($(".video-Box").find("object").length) { var e = $(".video-Box").find("object"), t = e.parents(".video-Box"), n = t.find(".video-View"), r = t.find(".video-ViewMask"), i = t.offset().top, s = t.height(), o = $(window).scrollTop(), u = $(window).height(), a = $(window).width(); i + s >= o && i < o + u ? (n.removeClass("View-fixed"), l()) : (f(), isNaN(parseFloat(r.css("left"))) && l()); function f() { n.addClass("View-fixed") } function l() { r.css("left") == "auto" || r.css("top") == "auto" ? r.css({ position: "fixed", bottom: "0", top: u - 200, right: "0", left: a - 300, zIndex: "1000" }) : r.css({ position: "fixed", bottom: "0", top: r.css("top"), right: "0", left: r.css("left"), zIndex: "1000" }) } r.on("mousedown", function (e) { var t, i, s, o, u, a; t = parseFloat(r.css("left")), i = parseFloat(r.css("top")), s = e.clientX, o = e.clientY, $(document).bind("mousemove", function (e) { u = t + e.clientX - s, a = i + e.clientY - o, r.css({ left: u, top: a, position: "fixed" }), n.css({ top: a, left: u }) }), $(document).bind("mouseup", function (e) { $(document).unbind("mousemove"), $(document).unbind("mouseup") }) }) } } var e = $(this), t = e.find(".video-Img"), n = e.find(".video-View"), r = e.find(".video-close"), i = App.dataApi.videoPlay; t.on("click", function (r) { function u(e, t, n) { if (t == 1) var r = "liveplay"; else if (t == 2) var r = "replay"; var i = { sn: e, type: r }; playSwf = "http://s4.qhimg.com/static/7e25b847945484bb/BeijingTime.swf", playerProductInstall = "http://s1.qhimg.com/static/db3e04bd6db0bbba.swf"; var s = { menu: "false", wmode: "window", bgcolor: "#000000", allowFullScreen: "true", allowScriptAccess: "always" }; swfobject.embedSWF(playSwf, n, "100%", "100%", "6.0.0", playerProductInstall, i, s) } r.preventDefault(); var s = t.data("videoid"), o = "video-player-" + s + ""; $.ajax({ type: "get", dataType: "jsonp", data: { id: s }, url: i }).done(function (e) { if (e.errno == 0) { var e = e.data, r = e.play_status; if (e.video_stream[2]) var i = e.video_stream[2].stream_url; else if (e.video_stream[1]) var i = e.video_stream[1].stream_url; else if (e.video_stream[0]) var i = e.video_stream[0].stream_url; videoObjectRemove(), setTimeout(function () { t.hide() }, 0), n.show(), n.append('<div class="video-ViewMask"><a href="" class="video-close">x</a>\u70b9\u51fb\u6309\u4f4f\u89c6\u9891\u53ef\u62d6\u52a8</div><div id =' + o + "></div>"), u(i, r, o) } }), e.on("click", ".video-close", function (e) { e.preventDefault(), videoObjectRemove() }) }), $(window).on("scroll", s) }) }, App.sportsDynamic = function () { var e = $("#sportsDynamic"); if (!e.length) return; loadScript("http://sports.163.com/special/00050A44/2013sportsscore.js", function (t) { if (t !== "error") { var n = sports_matchnav_data, r = []; for (i in n) n.hasOwnProperty(i) && i < 8 && r.push('<li><a href="', n[i].hoverInfo1Link, '"><table><tr><td><span class="f14">', n[i].hoverInfo1, '</span></td><td><span class="battle">', n[i].battle1, "</span></td><td>", n[i].battle1Score, "</td></tr><tr><td><em>", n[i].date, '</em></td><td><span class="battle">', n[i].battle2, "</span></td><td>", n[i].battle2Score, "</td></tr></table></a></li>"); e.find("ul").html(r.join("")), e.find("li:odd").addClass("fr") } }) }, App.waterfall = function () { function m() { function c(e) { var n = []; for (var r = 0; r < chinaAreaMap[e][2].length; r++) s = chinaAreaMap[e][0], u = chinaAreaMap[e][2][r][0], n.push('<li><a href="javascript:;" data-num="', r, '" data-type="city" data-prov="', s, '" data-loc="', u, '">', u, "</a></li>"); t.find(".citys-inner").html(n.join("")), t.find(".citys").show(), t.find(".provinces").hide() } function p(n) { e.html("\u672c\u5730(" + n + ")"), qboot.cookie.set("loc_default", n, { expires: 31536e6 }), $("#article-local").length ? ($(".article-list").hide(), $("#article-local").show().html(""), t.find('[data-nav="local"]').click(), $(window).off("scroll.article-list"), t.removeClass("article-hover"), g()) : (t.removeClass("article-hover"), t.find('[data-nav="local"]').click()) } function d(e) { a.reverse[e] != e ? (t.find(".citys").show(), t.find(".provinces").hide(), c(a.num[a.reverse[e]])) : (t.find(".citys").hide(), t.find(".provinces").show()), t.find(".local-list li a").removeClass("cur").filter("[data-loc=" + e + "]").addClass("cur") } var e = $('[data-nav="local"]'), n = [], r = App.dataApi.getLocation, i = qboot.cookie.get("loc_default") ? qboot.cookie.get("loc_default") : "", s, u, a = { provinces: {}, all: {}, num: {}, reverse: {} }; if (e.length) { t.append('<div class="local-list"><div class="local-box"><span class="icon icon-arr"></span><ul class="provinces"></ul><div class="citys" style="display:none;"><a href="javascript:;" class="back-up-level">\u8fd4\u56de\u4e0a\u4e00\u7ea7</a><ul class="citys-inner"></ul></div></div></div>'); for (var f = 0; f < chinaAreaMap.length; f++) { s = chinaAreaMap[f][0], s != "\u9493\u9c7c\u5c9b" && n.push('<li><a href="javascript:;" data-num="', f, '" data-type="prov" data-loc="', s, '">', s, "</a></li>"), a.reverse[s] = s; if (chinaAreaMap[f][2].length > 1) for (var l = 0; l < chinaAreaMap[f][2].length; l++) a.reverse[chinaAreaMap[f][2][l][0]] = s, a.num[s] = f } t.find(".provinces").html(n.join("")) } if (i) { var h; if (a.reverse[i] == i) var h = i; else var h = i + "_" + a.reverse[i]; e.html("\u672c\u5730(" + i + ")"), e.data("area", h) } else App.userLocal(function (t) { if (t.errno == 0) { var n = t.data.city; n ? (e.html("\u672c\u5730(" + n + ")"), e.data("area", n), qboot.cookie.set("loc_default", n, { expires: 31536e6 })) : (e.html("\u672c\u5730(\u5317\u4eac)"), e.data("area", "\u5317\u4eac")) } else e.html("\u672c\u5730(\u5317\u4eac)"), e.data("area", "\u5317\u4eac") }); t.find(".provinces a").on("click", function (t) { t.preventDefault(), $("#article-" + o).data("lastid", ""), $("#article-" + o).data("pdate", ""); var n = $(this).data("num"), r = $(this).data("loc"), i = $(this).html(); chinaAreaMap[n][2].length > 1 ? c(n) : (p(i), e.data("city", r), e.data("area", r)) }), t.on("click", ".citys-inner a", function (t) { $("#article-" + o).data("lastid", ""), $("#article-" + o).data("pdate", ""), t.preventDefault(); var n = $(this).data("prov"), r = $(this).data("loc"); h = r + "_" + n, e.data("area", h), e.data("city", r), p(r) }), t.find(".back-up-level").on("click", function (e) { e.preventDefault(), t.find(".citys").hide(), t.find(".provinces").show() }), t.hover(function () { clearTimeout(t.timerId) }, function () { t.timerId = setTimeout(function () { t.removeClass("article-hover") }, 300) }), $('[data-nav="local"]').hover(function () { clearTimeout(t.timerId); if (!t.hasClass("article-hover")) { var e = $(this).data("city"); t.addClass("article-hover"), e ? d(e) : i ? d(i) : d("\u5317\u4eac") } }) } function g() { function n() { var n = $(document).scrollTop(), i = $(window).height(), s = e.offset().top + e.height(); n + i > s + 28 && (t && clearTimeout(t), t = setTimeout(function () { y(++v, l || r || "", f || "") }, 200)) } var t; if (!e.length) return; $(window).on("scroll.article-list", n).trigger("scroll") } function y(e, t, n) { d.data("curpage", e); var r = this, s = md5(qboot.cookie.get("__guid")), f, l, v, m = $("#article-" + o).data("lastid"), g = $("#article-" + o).data("pdate"); $(".index-wp").length && o == "Irecommend" ? (f = App.dataApi.tuijian, l = "", v = "") : o == "wemedia" ? (f = App.dataApi.newList, l = "wemedia", v = 1) : o == "Ivideo" ? (f = App.dataApi.videoList, l = "", v = "", h = 15) : o == "IselfChannel" ? (f = App.dataApi.newList, l = "original", v = "") : o == "Ioriginal" ? (f = App.dataApi.newList, l = "original", v = "") : o == "Icomment" ? (f = App.dataApi.newList, l = "voice", v = "") : o == "Iimages" ? (f = App.dataApi.picNewList, l = "", v = 1) : o == "live-index" ? (f = App.dataApi.liveList, l = "") : o == "local" ? (f = App.dataApi.getLocalNews, p = $('[data-nav="local"]').data("area")) : o == "videos" ? f = App.dataApi.live : (f = App.dataApi.scroll, l = "", v = ""), u == "btvMedia" ? f = App.dataApi.getBtVideo : u == "media" && (f = App.dataApi.bjMedia), $(".live-wp").length && (f = App.dataApi.live), $(".video-wp").length && (f = App.dataApi.live), o == "local" && $('[data-nav="local"]').data("area") == "\u5317\u4eac" && (f = App.dataApi.bjMedia), this._articleListLoading || $.ajax({ url: f, type: "get", dataType: "jsonp", beforeSend: function () { var e = '<div class="article-load"><span class="more">\u6b63\u5728\u4e3a\u4f60\u52a0\u8f7d\u66f4\u591a</span></div>'; d.append(e), r._articleListLoading = !0 }, data: { page: e, pid: t, name: l, cid: n, src: a, type: v, lastid: m, pdate: g, uid: s, limit: 15, position: p, from: "btime" } }).done(function (e) { if (e.errno == 0) { var e = e.data, t = []; if (!e.length) { var n = '<div class="article-nonews"><span class="more">\u6682\u65f6\u6ca1\u6709\u65b0\u95fb</span></div>'; $(window).off("scroll.article-list"), d.find(".article-nonews").remove(), d.append(n) } else d.find(".article-nonews").remove(), e[e.length - 1].id ? $("#article-" + o).data("lastid", e[e.length - 1].id) : $("#article-" + o).data("lastid", ""), e[e.length - 1].pdate ? $("#article-" + o).data("pdate", e[e.length - 1].pdate) : $("#article-" + o).data("pdate", ""); d.find(".article-load").remove(); for (i in e) if (e.hasOwnProperty(i)) { if (e[i].url) var s = e[i].url; else var s = e[i].static_url; e[i].src == "" ? c = 'style="display:none"' : c = ""; if (e[i].news_type == 3) t.push('<div class="N-mod"><div class="article-txt"><div class="pic"><a href="', s, '"><img src="', App.ui.recut(e[i].image_url, "200_114_", "dmfd"), '" alt="', e[i].title, '"><i class="icon icon-play"></i><em class="time">', e[i].length, '</em></a></div><div class="txt"><h3 class="title"><a href="', s, '">', e[i].title, '</a></h3><p class="brief">', e[i].summary, '</p><p class="info" ', c, ">\u6765\u6e90\uff1a", e[i].src, "</p></div></div></div>"); else if (e[i].news_type == 2) { var u = e[i].image_url.split("|"), a = []; for (var f = 0; f < u.length; f++) a.push('<li><img src="', App.ui.recut(u[f], "150_100_", "dmfd"), '" alt="', e[i].title, '" ></li>'); t.push('<div class="N-mod"><div class="article-img-4"><h3 class="title"><a href="', s, '">', e[i].title, '</a></h3><a href="', s, '"><ul class="img-list">', a.join(""), '</ul></a><p class="brief">', e[i].summary, '</p><p class="info" ', c, ">\u6765\u6e90\uff1a", e[i].src, "</p></div></div>") } else if (e[i].image_url) { var l = e[i].image_url.split("|"); t.push('<div class="N-mod"><div class="article-txt"><div class="pic"><a href="', s, '"><img src="', App.ui.recut(l[0], "180_100_", "dmfd"), '" alt="', e[i].title, '"></a></div><div class="txt"><h3 class="title"><a href="', s, '">', e[i].title, '</a></h3><p class="brief">', e[i].summary, '</p><p class="info" ', c, ">\u6765\u6e90\uff1a", e[i].src, "</p></div></div></div>") } else t.push('<div class="N-mod"><div class="article-txt"><div class="txt"><h3 class="title"><a href="', s, '">', e[i].title, '</a></h3><p class="brief">', e[i].summary, '</p><p class="info" ', c, ">\u6765\u6e90\uff1a", e[i].src, "</p></div></div></div>") } d.append(t.join("")), r._articleListLoading = !1 } }) } var e = $("#article-bd"), t = $(".article-nav"), n = t.find("a"), r = t.find("a").eq(0).attr("data-pid"), s = t.find("a").eq(0).attr("data-nav"), o = t.children("a:eq(0)").data("nav"), u = t.children("a:eq(0)").data("apitype"), a = t.children("a:eq(0)").data("src"), f = t.children("a:eq(0)").data("cid"), l = t.children("a:eq(0)").data("pid"), c, h, p, d = e.find(".article-list").eq(0), v = 0; if (s == "") { t.hide(); return } n.on("click", function (n) { n.preventDefault(); var r = $(this); o = r.attr("data-nav"), l = r.attr("data-pid"), f = r.attr("data-cid"), a = r.attr("data-src"), u = r.attr("data-apitype"), d = e.find("#article-" + o), videoObjectRemove(e), t.removeClass("article-hover"), v = d.data("curpage") || 0; if (r.parent().hasClass("scrollfixed")) { var i = $(".article").offset().top; document.body.scrollTop = i + 2, document.documentElement.scrollTop = i + 2 } App.ui.cur(r), d.length ? (e.find(".article-list").hide(), d.show()) : (e.find(".article-list").hide(), e.append('<div class="article-list" id="article-' + o + '" bk="article-' + o + '"></div>'), d = e.find("#article-" + o), d.show(), $(window).off("scroll.article-list"), g()) }), g(), m(), $(".bjMediaXjb-wp").length && t.prepend('<div class="media-logo"><a href="http://www.bjnews.com.cn"></a></div>'), $(".bjMediaJhsb-wp").length && t.prepend('<div class="media-logo"><a href="http://epaper.jinghua.cn/"></a></div>'), $(".bjMediaFzwb-wp").length && t.prepend('<div class="media-logo"><a href="http://www.fawan.com/"></a></div>'), $(".bjMediaCb-wp").length && t.prepend('<div class="media-logo"><a href="http://www.morningpost.com.cn/"></a></div>'), $(".bjMediaBjwb-wp").length && t.prepend('<div class="media-logo"><a href="http://bjwb.bjd.com.cn/"></a></div>'), $(".bjMediaBjqnb-wp").length && t.prepend('<div class="media-logo"><a href="http://epaper.ynet.com/"></a></div>'), $(".bjMediaBjrb-wp").length && t.prepend('<div class="media-logo"><a href="http://bjrb.bjd.com.cn/"></a></div>'), $(".bjMediaBjsb-wp").length && t.prepend('<div class="media-logo"><a href="http://www.bbtnews.com.cn/"></a></div>') }, App.toTop = function () { var e = !1, t = !1; $(".N-wp").append('<div id="atom-totop"><span class="atom-ewm"></span><a href="http://www.btime.com" class="return-index" target="_self">\u8fd4\u56de\u9996\u9875</a><a href="#" class="totop"></a><span class="atom-ewm-box"></span></div>'), $(window).scroll(function () { var n = document.documentElement.scrollTop || document.body.scrollTop, r = document.documentElement.clientHeight || document.body.clientHeight; n > r / 2 ? t || (t = !0, e = !1, $("#atom-totop").show()) : e || (e = !0, t = !1, $("#atom-totop").hide()) }), $("#atom-totop .totop").click(function (e) { e.preventDefault(), document.body.scrollTop = 0, document.documentElement.scrollTop = 0 }), $("#atom-totop .atom-ewm").hover(function () { $(".atom-ewm-box").show() }, function () { $(".atom-ewm-box").hide() }) }, App.ui.sortList = function (e) { var e = e, t = function (e, t) { var e = e.score, t = t.score; return t - e }; return e.sort(t), e }, App.ui.score = function (e) { var t = (e / 10).toFixed(1), e = t <= .2 && 20 || t <= .4 && 40 || t <= .6 && 60 || t <= .8 && 80; return e }, App.ui.cur = function (e, t, n) { var e = $(e) || e, n = n || "", r = t || "cur"; e.addClass(r).siblings(n).removeClass(r) }, App.ui.recut = function (e, t, n) { result = e; if (result && t) { var r = e.match(/^(http:\/\/.+?)(\/.+)*(\/.+)$/); r.length > 0 && (result = [r[1], "/", n, "/", t, r[3]].join("")) } return result }, App.userLogin = function () { var e = $(".userinfo"), t = qboot.cookie, n = '<img src="http://p6.qhimg.com/d/inn/7f69123b/_user_photo.png"><a href="http://user.btime.com/viewShow?gate=login">\u767b\u5f55</a> |<a href="http://user.btime.com/viewShow?gate=register">\u6ce8\u518c</a>'; t.get("lf") == 1 ? $.ajax({ type: "get", dataType: "jsonp", url: App.dataApi.userLogin }).done(function (t) { if (t.errno == 0) { var r; t.data.head_img === null ? r = "http://p6.qhimg.com/d/inn/7f69123b/_user_photo.png" : r = t.data.head_img.img_30; var i = '<a href="http://user.btime.com/viewShow?gate=info"><img src="' + r + '"></a>' + '<span class="user-Name" data-uid="' + t.data.user_id + '">' + '<a href="http://user.btime.com/viewShow?gate=info">' + t.data.nick_name + "</a>" + "<p>" + "<i></i>" + '<a href="http://user.btime.com/viewShow?gate=info">\u8bbe\u7f6e</a>' + '<a href="" class="user-login-out">\u9000\u51fa</a>' + "</p>" + "</span>"; e.html(i), e.on("mouseenter", ".user-Name", function () { $(this).find("p").show() }), e.on("mouseleave", ".user-Name", function () { $(this).find("p").hide() }) } else e.html(n) }) : e.html(n), e.on("click", ".user-login-out", function (t) { t.preventDefault(), $.ajax({ type: "get", dataType: "jsonp", url: App.dataApi.userLoginOut }).done(function (t) { t.errno == 0 ? e.html(n) : alert("\u9000\u51fa\u5931\u8d25!") }) }) }, App.bjMedia = function () { var e = $("#media-kandian"), t = App.dataApi.mediaKd; if (!e.length) return; $.ajax({ type: "get", dataType: "jsonp", url: t }).done(function (t) { if (t.errno == 0) { var t = t.data, n = []; for (var r in t) if (t.hasOwnProperty(r)) { var i = [], s, o; t[r].list.length == 0 ? o = "hide" : o = ""; switch (t[r].name) { case "\u65b0\u4eac\u62a5": s = "xjb"; break; case "\u4eac\u534e\u65f6\u62a5": s = "jhsb"; break; case "\u6cd5\u5236\u665a\u62a5": s = "fzwb"; break; case "\u5317\u4eac\u6668\u62a5": s = "cb"; break; case "\u5317\u4eac\u665a\u62a5": s = "bjwb"; break; case "\u5317\u4eac\u9752\u5e74\u62a5": s = "bjqnb"; break; case "\u5317\u4eac\u5a31\u4e50\u4fe1\u62a5": s = "xb"; break; case "\u5317\u4eac\u65e5\u62a5": s = "bjrb"; break; case "\u5317\u4eac\u5546\u62a5": s = "bjsb" } for (var u in t[r].list) t.hasOwnProperty(u) && i.push('<li><a href="', t[r].list[u].image_url, '">', t[r].list[u].title, "</a></li>"); n.push('<dl class="' + o + '">' + '<dt><i class="icon icon-' + s + '"></i> ', t[r].name, "</dt><dd><ul>", i.join(""), "</ul></dd></dl>") } } e.html(n.join("")) }) }, App.userInfo = function (e) { $.ajax({ url: App.dataApi.userLogin, type: "get", dataType: "jsonp" }).done(function (t) { e(t) }) }, App.userLocal = function (e) { $.ajax({ url: App.dataApi.getLocation, type: "get", dataType: "jsonp" }).done(function (t) { e(t) }) }, App.setHome = function () { function t(e) { document.all ? (document.body.style.behavior = "url(#default#homepage)", document.body.setHomePage(e)) : alert("\u60a8\u597d,\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u81ea\u52a8\u8bbe\u7f6e\u9875\u9762\u4e3a\u9996\u9875\u529f\u80fd,\u8bf7\u60a8\u624b\u52a8\u5728\u6d4f\u89c8\u5668\u91cc\u8bbe\u7f6e\u8be5\u9875\u9762\u4e3a\u9996\u9875!") } var e = $(".index-wp"); e.length && e.find(".N-topr").append('<span class="set-Home">\u8bbe\u4e3a\u9996\u9875</span>'), e.on("click", ".set-Home", function () { t("http://www.btime.com") }) }, App.advertisement = function () { function t(e) { var t = 1, n = 0, r; if (e) { t = 0; for (r = e.length - 1; r >= 0; r--) n = e.charCodeAt(r), t = (t << 6 & 268435455) + n + (n << 14), n = t & 266338304, t = n != 0 ? t ^ n >> 21 : t } return t } var e = {}; e.getUID = function () { var n = new Date - 0, r = window.location.href, i = t(r); return uid = "" + n + i + Math.random() + Math.random() + Math.random() + Math.random(), uid = uid.replace(/\./g, "").substring(0, 32), e._uid = uid, uid }; var n = e.getUID(), r = { init: function (e) { var t = this, r = "http://show.g.mediav.com/s?type=1&of=4&showid=CkUxUN&uid=" + n, i = [], e = parseInt(e, 10), s = -1, o = 60, u = []; $.ajax({ url: r, type: "get", dataType: "jsonp", jsonp: "jsonp", timeout: 2e3, data: {} }).done(function (n) { if (n == "") return; $.each(n, function (e, t) { if (!t.title) return; if (!t.link) return; if (!t.image) return; if (!t.desc) return; if (!t.advertiser) return; var n = $('<div class="N-mod ad_box"><div class="article-txt "><a href="' + t.link + '">' + '<div class="pic"><img src="' + t.image + '" alt="' + t.title + '"></div>' + '<div class="txt">' + '<h3 class="title">' + t.title + "</h3>" + '<p class="brief">' + t.desc + "</p>" + '<p class="info"><span class="ad_icon"></span></p>' + "</div>" + "</a>" + "</div>" + "</div>"); t.imptk.length > 0 && n.data("show_req", t.imptk), t.clicktk.length > 0 && n.data("click_req", t.clicktk), i.push(n) }), $(".article-list .ad_box").length ? s = parseInt($(".article-list .ad_box").last().index(), 10) : $(".article-list .ad_editor").length && (s = parseInt($(".article-list .ad_editor").last().index(), 10)); for (var r = 0; r < i.length; r++) { var a = (r + 1) * e + s + r; a < o && u.push(a) } $.each(u, function (e, t) { $(".article-list .N-mod").eq(t).after(i[0]), i.shift() }), $.each($(".article-list .ad_box"), function (e, n) { var r = $(this).data("show_req"); r && ($.each(r, function (e, n) { t.request(n) }), $(this).data("show_req", "")) }), $.each($(".article-list .ad_box"), function (e, n) { $(this).find("a").click(function () { var e = $(this).closest(".N-mod").data("click_req"); e && $.each(e, function (e, n) { t.request(n) }) }) }) }).fail(function (e) { e.statusText == "timeout" }) }, request: function (e) { var t = $('<img style="display:none;" src="' + e + '"/>'); $("body").append(t) } }; r.init(4), setTimeout(function () { r.init(4) }, 2e3) }, $(function () { $(".N-nav").find(".nav-media").hover(function () { $(this).find(".nav-pop").fadeIn(100) }, function () { $(this).find(".nav-pop").fadeOut(100) }), qboot.cookie.remove("__guid", { path: "/" }), App.scrollfix(), App.focusImg(), App.focusVideoImg(), App.calendar(), App.tab(), App.hotMovie(), App.cinema(), App.hotTvSeries(), App.movieLibrary(), App.hotNews(), App.beijingNews(), App.appList(), App.btvVideo(), App.sportsDynamic(), App.waterfall(), App.toTop(), App.userLogin(), App.videoPlay(), App.bjMedia(), App.setHome(), App.advertisement() });